{% extends "Sidebar.html" %} {% load static %} {% block content %}
<meta charset="UTF-8" />
<title>{{ playlist.title }}</title>
<style>
  /* body {
      background: #121212;
      color: #fff;
      font-family: Arial, sans-serif;
    } */
  .playlist-header {
    display: flex;
    align-items: center;
    padding: 20px;
  }
  .playlist-header img {
    width: 200px;
    height: 200px;
    border-radius: 8px;
    margin-right: 20px;
  }
  .playlist-info h1 {
    font-size: 48px;
    margin: 0;
  }
  .playlist-info p {
    color: #b3b3b3;
  }
  .tracks {
    margin: 20px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    color: #b3b3b3;
  }
  th,
  td {
    padding: 12px;
    border-bottom: 1px solid #282828;
    text-align: left;
  }
  th {
    color: #fff;
  }
  .track-img {
    width: 50px;
    height: 50px;
    border-radius: 4px;
  }
  .play-btn {
    background: #1db954;
    color: white;
    padding: 12px 20px;
    border: none;
    border-radius: 50%;
    font-size: 24px;
    cursor: pointer;
    margin: 20px;
  }
</style>

<div class="playlist-header">
  {% with playlist.thumbnails|last as last_thumb %} {% if last_thumb %}
  <img src="{{ last_thumb.url }}" alt="Playlist cover" />
  {% else %} {% if tracks.0.thumbnails %}
  <img src="{{ tracks.0.thumbnails.1.url }}" alt="Track cover" />
  {% else %}
  <img src="{% static 'default_cover.jpg' %}" alt="Default cover" />
  {% endif %} {% endif %} {% endwith %}

  <div class="playlist-info">
    <p>PLAYLIST</p>
    <h1>{{ playlist.title }}</h1>

    {% if playlist.description %}
    <p>{{ playlist.description }}</p>
    {% endif %}
    <p></p>
    <p>
      {% if playlist.author.name %} {{ playlist.author.name }} {% endif %} 
      {% if playlist.author.name and playlist.trackCount %} • {% endif %} 
      {% if playlist.trackCount %} {{ playlist.trackCount }} songs {% endif %} 
      {% if playlist.duration %} • {{ playlist.duration }} {% endif %}
    </p>
  </div>
</div>

<button class="play-btn" style="cursor: pointer" onclick="play_playlist(0)">
  ▶
</button>

<div class="tracks">
  <table>
    <thead>
      <tr>
        <th>#</th>
        <th>Title</th>
        <th>Artist</th>
        <th>Duration</th>
      </tr>
    </thead>
    <tbody>
      {% comment %} <tr
        onclick="playTrackById('{{ track.videoId }}')"
        style="cursor: pointer"
      >
        <td>{{ forloop.counter }}</td>
        <td>
          <img class="track-img" src="{{ track.thumbnails.0.url }}" alt="" />
          {{ track.title }}
        </td>
        <td>
          {% for artist in track.artists %} {{ artist.name }}
            {% if not forloop.last %}, 
            {% endif %}
          {% endfor %}
        </td>
        <td>{{ track.duration }}</td>
      </tr> {% endcomment %}
        {% for track in tracks %}
        <tr  onclick="play_playlist({{ forloop.counter0 }})">
          <td>{{ forloop.counter }}</td>
          <td>
            <img class="track-img" src="{{ track.thumbnails.0.url }}" alt="" />
            {{ track.title }}
          </td>
          <td>
            {% for artist in track.artists %} {{ artist.name }}
              {% if not forloop.last %}, {% endif %} 
            {% endfor %}
          </td>
          <td>{{ track.duration }}</td>
        </tr>
        {% endfor %}
    </tbody>
  </table>
</div>

<script>
  function play_playlist(currentIndex) {
    console.log(currentIndex)
    const queryString = window.location.search
    const urlParams = new URLSearchParams(queryString)
    const playlistId = urlParams.get("id")
    
    if (playlistId) {
      fetch(`/api/player/?playlistId=${playlistId}`)
        .then((res) => res.json())
        .then((data) => {
          if (data.tracks && data.tracks.length) {
            window.tracks = data.tracks // set global playlist
            window.currentIndex = currentIndex // start from first track
            
            loadTrackByData(data.tracks[window.currentIndex], true) // play first track
            populatePlaylist() // update drawer UI
          }
        })
    }
  }
</script>

{% comment %} <script>
  function play_playlist() {
    const queryString = window.location.search
    const urlParams = new URLSearchParams(queryString)
    const playlistId = urlParams.get("id")

    // Call global overlay player function
    if (playlistId) {
      fetch(`/api/player/?playlistId=${playlistId}`)
        .then((res) => res.json())
        .then((data) => {
          if (data.tracks && data.tracks.length) {
            window.tracks = data.tracks // set global playlist
            window.currentIndex = 0 // start from first track
            loadTrackByData(data.tracks[0], true) // play first track
            populatePlaylist() // update drawer UI
          }
        })
    }
  }
</script> {% endcomment %}

{% endblock %}
