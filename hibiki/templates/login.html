{% load static %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Login</title>
    <script src="{% static 'hibiki/js/animate_route.js' %}"></script>
    <link rel="stylesheet" href="{% static 'hibiki/css/animate_route.css' %}" />
    <link rel="stylesheet" href="{% static 'hibiki/css/login.css' %}" />
  </head>

  <body class="fade-out">
    <div class="login-box">
      <h2>Welcome back!</h2>
      <p>Sign in to discover, stream, and enjoy millions of songs.</p>

      {% comment %} {% if messages %}
      <div class="messages">
        {% for message in messages %}
        <p class="alert {{ message.tags }}">{{ message }}</p>
        {% endfor %}
      </div>
      {% endif %} {% endcomment %}

      {% comment %} <div class="messages">
        <p class="alert error">Username exits</p>
      </div> {% endcomment %}

      <form method="POST" id="loginForm" onsubmit="return validateLogin()">
        {% csrf_token %}
        <input type="text" name="username" placeholder="Username" required />
        <small id="usernameError" class="error"></small>

        <input
          type="password"
          name="password"
          placeholder="Password"
          required
        />
        <small id="passwordError" class="error"></small>

        <button class="login-btn" type="submit">Sign in</button>
      </form>

      {% if form.errors %}
      <div class="error">
        error {% for field, errors in form.errors.items %} {% for error in errors %}
        <p>{{ error }}</p>
        {% endfor %} {% endfor %}
      </div>
      {% endif %}

      <div class="Register">
        <p>
          Donâ€™t have an account? <a href="{% url 'register' %}">Register</a>
        </p>
      </div>
    </div>

    <script>
      function validateLogin() {
        let username = document.querySelector("[name='username']").value.trim()
        let password = document.querySelector("[name='password']").value

        // Clear old messages
        let messagesBox = document.querySelector(".messages")
        messagesBox.innerHTML = ""

        let hasError = false

        if (username.length < 3 || password.length < 6) {
          hasError = true
        }

        if (hasError) {
          let p = document.createElement("p")
          p.classList.add("alert", "error")
          p.innerText = "Invalid username or password"
          messagesBox.appendChild(p)
          return false // stop form submit
        }

        return true // allow submit
      }

        {% comment %} <script>
          function validateLogin() {
            let username = document.querySelector("[name='username']").value.trim()
            let password = document.querySelector("[name='password']").value

            let valid = true

            document.getElementById("usernameError").innerText = ""
            document.getElementById("passwordError").innerText = ""

            if (username.length < 3) {
              document.getElementById("usernameError").innerText =
                "Username must be at least 3 characters."
              valid = false
            }
            if (password.length < 6) {
              document.getElementById("passwordError").innerText =
                "Password must be at least 6 characters."
              valid = false
            }

            return valid
          }
    </script>
    {% endcomment %}
  </body>
</html>
